<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CGT TotalEnergies</title>
    
    <!-- Priorité maximale pour le logo -->
    <link rel="preload" as="image" href="logo.jpg" fetchpriority="high">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Montserrat', 'sans-serif'] },
                    colors: {
                        cgtRed: '#E30613',
                        totalBlue: '#005EB8',
                        bgLight: '#F3F4F6'
                    }
                }
            }
        }
    </script>
    <style>
        /* Optimisations pour un affichage instantané et fluide sur mobile */
        * { 
            -webkit-tap-highlight-color: transparent; 
            box-sizing: border-box;
        }
        
        html, body {
            overflow: hidden;
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            background-color: #E30613;
            position: fixed;
        }
        
        .app-frame {
            position: relative;
            width: 100%;
            height: 100dvh;
            background: #F3F4F6;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .app-frame {
                width: 375px;
                height: 90vh;
                border-radius: 30px;
                margin: 5vh auto;
            }
        }

        header {
            flex: 0 0 auto;
            background: white;
            padding: 12px 16px;
            padding-top: calc(env(safe-area-inset-top) + 12px);
            border-bottom: 1px solid #e5e7eb;
            z-index: 50;
        }

        main {
            flex: 1 1 auto;
            overflow-y: auto;
            overflow-x: hidden;
            background: #F3F4F6;
            padding-bottom: 110px;
            -webkit-overflow-scrolling: touch;
        }

        .view-container { display: none; width: 100%; }
        .view-container.active { display: block; }

        nav {
            flex: 0 0 auto;
            background: white;
            padding: 12px 20px;
            padding-bottom: calc(env(safe-area-inset-bottom) + 12px);
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
        }

        #splash-screen {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: #E30613;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s ease-out;
        }

        .image-placeholder {
            background-color: #e5e7eb;
            position: relative;
            overflow: hidden;
        }

        img {
            transition: opacity 0.2s ease-in;
            opacity: 0;
        }
        img.loaded {
            opacity: 1;
        }

        .article-content p { margin-bottom: 1rem; line-height: 1.6; color: #444; }
        .article-content h3 { font-weight: 700; font-size: 1.1rem; margin-top: 1.5rem; margin-bottom: 0.5rem; color: #111; }

        .confetti {
            position: absolute;
            width: 5px; height: 5px;
            z-index: 1001; pointer-events: none;
            animation: fall 2s linear forwards;
        }
        @keyframes fall { to { transform: translateY(100dvh) rotate(360deg); opacity: 0; } }
    </style>
</head>
<body>

    <!-- SPLASH SCREEN -->
    <div id="splash-screen">
        <div class="w-32 h-32 mb-6">
            <img src="logo.jpg" alt="Logo" class="w-full h-full object-contain rounded-full border-2 border-white/20 shadow-2xl" onload="this.classList.add('loaded')">
        </div>
        <div class="w-12 h-1 bg-white/20 rounded-full overflow-hidden">
            <div class="h-full bg-white w-full animate-pulse"></div>
        </div>
    </div>

    <div class="app-frame font-sans">
        <header>
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3" onclick="goHome()">
                    <div class="w-10 h-10 rounded-full overflow-hidden border border-gray-100 bg-gray-50">
                        <img src="logo.jpg" alt="Logo" class="w-full h-full object-contain" onload="this.classList.add('loaded')">
                    </div>
                    <div>
                        <h1 class="font-black text-sm leading-none text-gray-900">TotalEnergies</h1>
                        <p class="text-[9px] text-green-600 font-bold uppercase mt-1">● Connecté</p>
                    </div>
                </div>
                <button onclick="switchTab('contact')" class="w-9 h-9 bg-gray-50 rounded-full flex items-center justify-center border border-gray-100">
                    <i class="fas fa-bell text-gray-400 text-sm"></i>
                </button>
            </div>
        </header>

        <main id="main-scroll">
            <!-- VUE 1 : ACCUEIL -->
            <div id="view-sites" class="view-container active p-4">
                <div class="flex justify-between items-end mb-5">
                    <h2 class="text-2xl font-black text-gray-800">Nos Sites</h2>
                    <span class="text-[10px] font-bold text-gray-400 uppercase" id="sites-count">0 Sites</span>
                </div>
                
                <!-- Widgets -->
                <div class="grid grid-cols-3 gap-2 mb-6 text-center">
                    <div class="bg-white p-3 rounded-2xl shadow-sm border border-white">
                        <i class="fas fa-cloud-sun text-yellow-500 mb-1"></i>
                        <div class="text-[10px] font-black">14°C</div>
                    </div>
                    <div class="bg-white p-3 rounded-2xl shadow-sm border border-white">
                        <i class="fas fa-car text-blue-500 mb-1"></i>
                        <div class="text-[10px] font-black">Fluide</div>
                    </div>
                    <div class="bg-white p-3 rounded-2xl shadow-sm border border-white">
                        <i class="fas fa-leaf text-green-500 mb-1"></i>
                        <div class="text-[10px] font-black">Bon</div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3" id="sites-grid"></div>
            </div>

            <!-- VUE 2 : NEWS SITE -->
            <div id="view-news" class="view-container">
                <div class="relative h-56 w-full overflow-hidden image-placeholder">
                    <img src="" id="site-hero-img" class="w-full h-full object-cover" onload="this.classList.add('loaded')">
                    <div class="absolute inset-0 bg-black/40"></div>
                    <button onclick="goHome()" class="absolute top-4 left-4 w-8 h-8 bg-black/30 text-white rounded-full flex items-center justify-center">
                        <i class="fas fa-arrow-left text-xs"></i>
                    </button>
                    <div class="absolute bottom-4 left-4">
                        <h2 class="text-white text-2xl font-black leading-none" id="news-site-title">Site</h2>
                        <p class="text-white/60 text-[10px] font-bold uppercase mt-1">Section Syndicale</p>
                    </div>
                </div>
                <div class="p-4" id="news-feed"></div>
            </div>

            <!-- VUE 3 : AGENDA -->
            <div id="view-agenda" class="view-container p-4">
                <h2 class="text-2xl font-black mb-6">Calendrier Social</h2>
                <div id="agenda-list" class="space-y-3"></div>
            </div>

            <!-- VUE 4 : CONTACT -->
            <div id="view-contact" class="view-container p-4">
                <div class="bg-gray-900 p-8 rounded-[30px] text-white text-center mb-6">
                    <h2 class="text-xl font-black mb-2">Besoin d'aide ?</h2>
                    <p class="text-xs text-gray-400">Vos délégués vous répondent.</p>
                </div>
                <div class="space-y-3 text-sm">
                    <select id="contact-site-select" class="w-full bg-white p-4 rounded-xl border border-gray-200 font-bold h-14"></select>
                    <a href="mailto:Jad.zorgui07@gmail.com" class="block w-full bg-cgtRed text-white text-center py-4 rounded-xl font-bold shadow-lg shadow-red-500/20">EMAIL CGT</a>
                    <a href="https://wa.me/33788408004" target="_blank" class="block w-full bg-white border border-gray-200 text-center py-4 rounded-xl font-bold text-[#25D366]">WHATSAPP</a>
                </div>
            </div>
        </main>

        <nav>
            <button onclick="switchTab('home')" id="btn-home" class="w-12 h-12 rounded-full flex items-center justify-center bg-cgtRed text-white shadow-lg"><i class="fas fa-home"></i></button>
            <button onclick="switchTab('agenda')" id="btn-agenda" class="w-12 h-12 rounded-full flex items-center justify-center text-gray-400"><i class="fas fa-calendar-alt"></i></button>
            <button onclick="switchTab('contact')" id="btn-contact" class="w-12 h-12 rounded-full flex items-center justify-center text-gray-400"><i class="fas fa-comment-dots"></i></button>
        </nav>

        <!-- Overlay Article -->
        <div id="view-article" class="hidden absolute inset-0 bg-white z-[200] overflow-y-auto">
            <div class="relative h-64 image-placeholder">
                <img id="article-img" src="" class="w-full h-full object-cover" onload="this.classList.add('loaded')">
                <button onclick="closeArticle()" class="absolute top-6 right-6 w-10 h-10 bg-black/30 text-white rounded-full flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-5">
                <span id="article-tag" class="text-[9px] font-black text-cgtRed uppercase bg-red-50 px-2 py-1 rounded">INFOS</span>
                <h1 id="article-title" class="text-2xl font-black mt-3 leading-tight text-gray-900">Titre</h1>
                <p id="article-author" class="text-xs text-gray-400 mt-2 font-bold italic">Auteur</p>
                <div id="article-body" class="mt-6 text-gray-700 leading-relaxed text-sm article-content"></div>
                <div class="mt-10 mb-20 text-center">
                    <button onclick="toggleSupport(this)" class="w-full py-4 bg-gray-50 border border-gray-100 rounded-xl font-bold text-gray-500 active:bg-red-50 active:text-cgtRed transition-colors">
                        <i class="far fa-hand-rock mr-2"></i> <span class="btn-text">SOUTENIR (42)</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const rawSites = [
            { id: 'carling', name: 'Carling', region: 'Est', img: 'carling.jpg' },
            { id: 'donges', name: 'Donges', region: 'St-Nazaire', img: 'donges.jpg' },
            { id: 'feyzin', name: 'Feyzin', region: 'Lyon', img: 'feyzin.jpg' },
            { id: 'flandres', name: 'Flandres', region: 'Nord', img: 'flandres.jpg' },
            { id: 'grandpuits', name: 'Grandpuits', region: 'IDF', img: 'grandpuits.jpg' },
            { id: 'lamede', name: 'La Mède', region: 'Provence', img: 'lamede.jpg' },
            { id: 'normandie', name: 'Normandie', region: 'Le Havre', img: 'normandie.jpg' },
            { id: 'oudalle', name: 'Oudalle', region: 'Le Havre', img: 'oudalle.jpg' }
        ];

        const sites = rawSites.sort((a, b) => a.name.localeCompare(b.name));

        const agendaEvents = [
            { day: "12", month: "Fév", title: "Réunion NAO #4", loc: "Siège Paris" },
            { day: "15", month: "Fév", title: "AG du Personnel", loc: "Local CGT / Cantine" },
            { day: "18", month: "Fév", title: "Commission CSSCT", loc: "Salle de réunion A" },
            { day: "20", month: "Fév", title: "Permanence Juridique", loc: "Bureau CGT" },
            { day: "25", month: "Fév", title: "Comité Social Économique", loc: "Salle Plénière" }
        ];

        const siteContent = {
            'carling': [
                { title: "Avenir du site : Emplois locaux", tag: "Stratégie", author: "Karim", image: "https://images.unsplash.com/photo-1518709268805-4e9042af9f23?q=60&w=600", content: "<p>Défense des postes de maintenance sur les unités de vapocraquage.</p><h3>Vapocraquage</h3><p>Les rumeurs de restructuration inquiètent. Nous exigeons une vision claire à 10 ans.</p>" },
                { title: "Dotation EPI d'été", tag: "Santé", author: "Fred", image: "https://images.unsplash.com/photo-1504328345606-18bbc8c9d7d1?q=60&w=600", content: "<p>Demande de tenues adaptées aux fortes chaleurs pour les opérateurs terrain.</p>" }
            ],
            'donges': [
                { title: "NAO locales : Rapport de force", tag: "Social", author: "Fred", image: "https://images.unsplash.com/photo-1542281286-9e0a16bb7366?q=60&w=600", content: "<p>Les propositions de primes de site sont insuffisantes. Mobilisons-nous devant le portail à 14h.</p>" }
            ],
            'feyzin': [
                { title: "Incident Unité 12 : Alerte DGI", tag: "Alerte", author: "Louis Marc", image: "https://images.unsplash.com/photo-1516387933901-8266e7d6c817?q=60&w=600", content: "<p>Dépôt d'un Danger Grave et Imminent suite à l'incident survenu hier sur la torche Sud.</p>" }
            ],
            'flandres': [
                { title: "Plateforme logistique : Effectifs", tag: "Social", author: "Karim", image: "https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?q=60&w=600", content: "<p>La charge de travail augmente, les bras manquent. Embauches immédiates exigées.</p>" }
            ],
            'grandpuits': [
                { title: "Transition : Le compte n'y est pas", tag: "Avenir", author: "Louis Marc", image: "https://images.unsplash.com/photo-1508514177221-188b1cf16e9d?q=60&w=600", content: "<p>Projet solaire : nous exigeons des garanties concrètes pour le reclassement des techniciens.</p>" }
            ],
            'lamede': [
                { title: "Grand Arrêt : Sécurité", tag: "Urgent", author: "Fred", image: "https://images.unsplash.com/photo-1504917595217-d4dc5ebe6122?q=60&w=600", content: "<p>Contrôle strict des sous-traitants durant les travaux. Pas d'impasse sur la sécurité.</p>" },
                { title: "Planning 5x8 : Refus flexibilité", tag: "Social", author: "Karim", image: "https://images.unsplash.com/photo-1581094794329-c8112a89af12?q=60&w=600", content: "<p>La direction veut modifier les cycles de repos. Nous disons NON pour préserver notre santé.</p>" }
            ],
            'normandie': [
                { title: "Blocage expéditions : La force", tag: "Grève", author: "Olivier", image: "https://images.unsplash.com/photo-1527018601619-a508a2be00cd?q=60&w=600", content: "<p>Aucun produit ne sort ce matin. La direction doit enfin ouvrir de vraies négociations.</p>" }
            ],
            'oudalle': [
                { title: "Sécurité Chimie : Investissements", tag: "Sécurité", author: "Louis Marc", image: "https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?q=60&w=600", content: "<p>Focus sur la rénovation des pompes haute pression. La sécurité n'est pas négociable.</p>" }
            ],
            'default': [
                { title: "Mobilisation Nationale NAO 2026", tag: "National", author: "Olivier", image: "nao.jpg", content: "<p>La CGT appelle à une grève nationale mercredi prochain. Mobilisons-nous pour nos salaires.</p>" }
            ]
        };

        function init() {
            const grid = document.getElementById('sites-grid');
            const select = document.getElementById('contact-site-select');
            const agendaList = document.getElementById('agenda-list');
            
            sites.forEach(s => {
                grid.innerHTML += `
                    <div class="bg-white rounded-2xl overflow-hidden shadow-sm border border-gray-50 active:bg-gray-100 transition-colors" onclick="selectSite('${s.id}')">
                        <div class="h-24 image-placeholder">
                            <img src="${s.img}" alt="${s.name}" class="w-full h-full object-cover" decoding="async" loading="lazy" onload="this.classList.add('loaded')" onerror="this.src='https://via.placeholder.com/200?text=Site'">
                        </div>
                        <div class="p-3">
                            <h3 class="font-black text-xs leading-none text-gray-900">${s.name}</h3>
                            <p class="text-[8px] text-gray-400 font-bold uppercase mt-1 tracking-wider">${s.region}</p>
                        </div>
                    </div>`;
                select.innerHTML += `<option value="${s.id}">${s.name}</option>`;
            });

            agendaList.innerHTML = agendaEvents.map(e => `
                <div class="bg-white p-4 rounded-xl border border-gray-50 shadow-sm flex items-center gap-4">
                    <div class="w-10 h-10 bg-red-50 rounded-lg flex items-center justify-center text-cgtRed font-black flex-shrink-0">
                        <div class="text-center">
                            <div class="leading-none text-base">${e.day}</div>
                            <div class="text-[7px] uppercase font-bold">${e.month}</div>
                        </div>
                    </div>
                    <div>
                        <p class="text-sm font-bold text-gray-900 leading-tight">${e.title}</p>
                        <p class="text-[10px] text-gray-400 mt-0.5"><i class="fas fa-map-marker-alt mr-1 text-[8px]"></i>${e.loc}</p>
                    </div>
                </div>
            `).join('');

            document.getElementById('sites-count').textContent = sites.length + " Sites";

            setTimeout(() => {
                const splash = document.getElementById('splash-screen');
                if (splash) {
                    splash.style.opacity = '0';
                    setTimeout(() => splash.style.display = 'none', 400);
                }
            }, 400);

            document.getElementById('view-article').addEventListener('scroll', function() {
                const progress = (this.scrollTop / (this.scrollHeight - this.clientHeight)) * 100;
                document.getElementById('reading-progress').style.width = progress + '%';
            });
        }

        function selectSite(id) {
            const site = sites.find(s => s.id === id);
            document.getElementById('news-site-title').textContent = site.name;
            const hero = document.getElementById('site-hero-img');
            hero.classList.remove('loaded'); hero.src = site.img;
            
            document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
            document.getElementById('view-news').classList.add('active');
            document.getElementById('main-scroll').scrollTop = 0;
            renderNews(id);
        }

        function renderNews(id) {
            const feed = document.getElementById('news-feed');
            feed.innerHTML = '';
            const data = siteContent[id] || siteContent['default'];
            data.forEach(n => {
                feed.innerHTML += `
                    <div class="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm flex gap-4 active:bg-gray-50 mb-3" onclick="openArticle('${id}', '${n.title.replace(/'/g, "\\'")}')">
                        <div class="w-16 h-16 rounded-xl image-placeholder shrink-0">
                            <img src="${n.image}" class="w-full h-full object-cover" decoding="async" onload="this.classList.add('loaded')" onerror="this.src='https://via.placeholder.com/100?text=Info'">
                        </div>
                        <div class="flex-1">
                            <span class="text-[7px] font-black text-cgtRed uppercase tracking-wider">${n.tag || 'INFO'}</span>
                            <h4 class="font-bold text-xs leading-snug mt-1 text-gray-900">${n.title}</h4>
                            <p class="text-[9px] text-gray-400 mt-1">Par ${n.author}</p>
                        </div>
                    </div>`;
            });
        }

        function openArticle(siteId, title) {
            const data = siteContent[siteId] || siteContent['default'];
            const art = data.find(n => n.title === title);
            document.getElementById('article-title').textContent = art.title;
            const artImg = document.getElementById('article-img');
            artImg.classList.remove('loaded'); artImg.src = art.image;
            document.getElementById('article-tag').textContent = art.tag || 'INFO';
            document.getElementById('article-author').textContent = "Rédigé par " + art.author;
            document.getElementById('article-body').innerHTML = art.content;
            document.getElementById('view-article').classList.remove('hidden');
            document.getElementById('view-article').scrollTop = 0;
        }

        function switchTab(tab) {
            ['home', 'agenda', 'contact'].forEach(t => {
                const btn = document.getElementById(`btn-${t}`);
                if (t === tab) {
                    btn.className = "w-12 h-12 rounded-full flex items-center justify-center bg-cgtRed text-white shadow-lg transition-transform scale-110";
                } else {
                    btn.className = "w-12 h-12 rounded-full flex items-center justify-center text-gray-400 transition-transform scale-100";
                }
            });
            document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
            const targetId = (tab === 'home') ? 'view-sites' : 'view-' + tab;
            document.getElementById(targetId).classList.add('active');
            document.getElementById('main-scroll').scrollTop = 0;
        }

        function toggleSupport(btn) {
            const frame = document.querySelector('.app-frame');
            for (let i = 0; i < 20; i++) {
                const c = document.createElement('div');
                c.className = 'confetti';
                c.style.left = Math.random() * 100 + '%';
                c.style.backgroundColor = ['#E30613', '#FFD700', '#eee'][Math.floor(Math.random()*3)];
                c.style.animationDuration = (Math.random() + 1) + 's';
                frame.appendChild(c);
                setTimeout(() => c.remove(), 2000);
            }
            btn.classList.add('bg-red-50', 'text-cgtRed', 'border-cgtRed');
            btn.querySelector('.btn-text').textContent = "SOUTENU ! (43)";
        }

        function goHome() { switchTab('home'); }
        function closeArticle() { document.getElementById('view-article').classList.add('hidden'); }

        init();
    </script>
</body>
</html>
